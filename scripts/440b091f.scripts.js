"use strict";angular.module("facesQuizApp.service",["ngCookies","collection"]),angular.module("facesQuizApp",["facesQuizApp.service"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("facesQuizApp").controller("MainCtrl",["$scope","$timeout","Game","thoughtworkers",function(a,b,c,d){function e(b,c){h[c]||(a.game.guessPerson(b)?(h=[],g()):h[c]=f())}function f(){var a=["wobble"],b=Math.floor(Math.random()*a.length),c=["miss"];return c.push(a[b]),c.join(" ")}function g(){a.guess=function(){},b(function(){a.guess=e},200)}var h=[];a.loading=!0,d.query().then(function(b){a.game=new c(b),a.loading=!1},function(){a.loading=!1,a.failure=!0}),a.resetGame=function(){a.game.reset(),h=[]},a.isMistake=function(a){return h.indexOf(a)>=0},a.mistakesAnimationAt=function(a){return h[a]},a.guess=e}]),angular.module("collection",[]).filter("shuffle",function(){return function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}}).factory("ArrayFilter",["ArrayCollection",function(a){var b,c=function(a){b=a};return c.prototype.execute=function(c){var d=new a;return c.each(function(a){b(a)&&d.add(a)}),d},c}]).factory("ArrayCollection",["$filter",function(a){var b=function(a){this.items=a&&a.slice?a.slice():[]};return b.prototype.isEmpty=function(){return 0===this.size()},b.prototype.size=function(){return this.items.length},b.prototype.add=function(a){this.items.push(a)},b.prototype.remove=function(a){var b=this.items.indexOf(a);this.items.splice(b,1)},b.prototype.getAt=function(a){return this.items[a]},b.prototype.getNext=function(a){var b=this.items.indexOf(a)+1;return this.getAt(b)},b.prototype.getPrevious=function(a){var b=this.items.indexOf(a)-1;return this.getAt(b)},b.prototype.getLast=function(){return this.getAt(this.size()-1)},b.prototype.haveNext=function(a){return this.items.indexOf(a)+1<this.size()},b.prototype.havePrevious=function(a){return this.items.indexOf(a)>0},b.prototype.contains=function(a){return this.items.indexOf(a)>=0},b.prototype.notContains=function(a){return!this.contains(a)},b.prototype.getRandom=function(){return this.getAt(Math.floor(Math.random()*this.size()))},b.prototype.each=function(a){for(var b=0;b<this.size();b++){var c=this.getAt(b);a.call(this,c)}},b.prototype.shuffle=function(){this.items=a("shuffle")(this.items)},b.prototype.sample=function(a){var c=new b(this.items);return c.shuffle(),c.items=c.items.splice(0,a),c},b}]),angular.module("facesQuizApp.service").factory("Game",["$cookieStore","statistics","Crowd",function(a,b,c){var d=function(d){this.statistics=b,this.people=new c(d,a.get("ignored_people")),this.people.isThereAnyAvaliablePeople()?this.start():this.endGame()};return d.prototype.start=function(){this.ended=a.get("ended")||!1,this.nextTurn()},d.prototype.reset=function(){this.ended=!1,this.statistics.reset(),this.people.reset(),this.challengePerson=void 0,this.challengeGroup=void 0,this.start()},d.prototype.guessPerson=function(a){return this.isRightGuess(a)?(this.point(),this.endTurn(),!0):(this.mistake(),!1)},d.prototype.isRightGuess=function(a){return a===this.challengePerson},d.prototype.point=function(){this.statistics.point(),this.people.ignore(this.challengePerson)},d.prototype.mistake=function(){this.statistics.mistake()},d.prototype.endTurn=function(){this.people.isThereAnyAvaliablePeople()?this.nextTurn():this.endGame()},d.prototype.endGame=function(){this.ended=!0,a.get("ended",!0)},d.prototype.nextTurn=function(){this.challengePerson=this.people.getOneAvaliable(),this.challengeGroup=this.people.sample(4,this.challengePerson.gender),this.challengeGroup.notContains(this.challengePerson)&&(this.challengeGroup.remove(this.challengeGroup.getLast()),this.challengeGroup.add(this.challengePerson)),this.challengeGroup.shuffle()},d}]),angular.module("facesQuizApp.service").factory("Crowd",["$cookieStore","ArrayCollection","ArrayFilter",function(a,b){var c=function(a,c){var d=this;this.all=new b(a||[]),this.ignoredPeople=new b(c||[]),this.avaliablePeople=new b([]),this.all.each(function(a){d.ignoredPeople.notContains(a)&&d.avaliablePeople.add(a)})};return c.prototype.size=function(){return this.all.size()},c.prototype.isThereAnyAvaliablePeople=function(){return this.ignoredPeople.size()<this.all.size()},c.prototype.getOneAvaliable=function(){return this.avaliablePeople.getRandom()},c.prototype.isPersonIgnored=function(a){return this.avaliablePeople.notContains(a)&&this.ignoredPeople.contains(a)},c.prototype.sample=function(a,b){return b?this.sampleOfGender(a,b):this.sampleOfEveryone(a)},c.prototype.sampleOfEveryone=function(a){return this.all.sample(a)},c.prototype.sampleOfGender=function(a,c){for(var d=new b;d.size()<a;){var e=this.all.getRandom();d.notContains(e)&&e.gender===c&&d.add(e)}return d},c.prototype.ignore=function(a){this.ignoredPeople.add(a),this.avaliablePeople.remove(a),this.save()},c.prototype.save=function(){a.put("ignored_people",this.ignoredPeople.items)},c.prototype.reset=function(){a.remove("ignored_people"),this.avaliablePeople=new b(this.all.items),this.ignoredPeople=new b},c}]),angular.module("facesQuizApp.service").service("statistics",["$cookieStore",function(a){this.reset=function(){this.score=0,this.mistakes=0,this.save(this)},this.point=function(){this.score++,this.save()},this.mistake=function(){this.mistakes++,this.save()},this.save=function(){a.put("score",this.score),a.put("mistakes",this.mistakes)},this.initialize=function(){this.isPersisted()?this.loadStatistics():this.createStatistics()},this.isPersisted=function(){return void 0!==a.get("score")&&void 0!==a.get("mistakes")},this.loadStatistics=function(){this.score=a.get("score"),this.mistakes=a.get("mistakes")},this.createStatistics=function(){this.reset()},this.initialize()}]),angular.module("facesQuizApp.service").service("thoughtworkers",["$q","$http",function(a,b){var c;this.query=function(){return this.shouldQuery()&&this.queryPeople(),c.promise},this.shouldQuery=function(){return void 0===c},this.queryPeople=function(){c=a.defer(),b.get("api/thoughtworkers.json").success(function(a){c.resolve(a)}).error(function(a,b){c.reject(a,b)})}}]);